# 🏗️ 项目架构图

## 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    化工文档知识库AI系统                           │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据层 (Data Layer)                      │
├─────────────────────────────────────────────────────────────────┤
│  PDF文档 → PDF处理器 → 结构化JSON → 向量化 → ChromaDB向量数据库   │
│     │           │           │         │           │            │
│     │           │           │         │           │            │
│     ▼           ▼           ▼         ▼           ▼            │
│  chemical_   chemical_   structured  vector.py  chroma_db/     │
│  pdf_        pdf_        data        (向量化)    (持久化存储)    │
│  processor   processor   (JSON)                                │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      AI服务层 (AI Service Layer)                │
├─────────────────────────────────────────────────────────────────┤
│  ai_service.py          config_manager.py                      │
│  ├─ OpenAIProvider      ├─ 配置管理                            │
│  ├─ ClaudeProvider      ├─ 模型切换                            │
│  ├─ OllamaProvider      └─ 测试工具                            │
│  ├─ QwenProvider                                              │
│  └─ DeepSeekProvider                                          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    RAG管道层 (RAG Pipeline Layer)               │
├─────────────────────────────────────────────────────────────────┤
│  RAGPipeline                                                    │
│  ├─ 向量检索 (Vector Search)                                   │
│  ├─ 上下文构建 (Context Building)                              │
│  ├─ 提示词工程 (Prompt Engineering)                            │
│  └─ AI生成 (AI Generation)                                     │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     接口层 (Interface Layer)                   │
├─────────────────────────────────────────────────────────────────┤
│  ai_chat.py              api_server.py                         │
│  ├─ 交互式聊天界面        ├─ REST API服务器                     │
│  ├─ 命令处理             ├─ Web界面                            │
│  ├─ 历史管理             ├─ 健康检查                           │
│  └─ 多模型支持           └─ 跨域支持                           │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     工具层 (Utility Layer)                     │
├─────────────────────────────────────────────────────────────────┤
│  test_ai_integration.py  start_ai.py                           │
│  ├─ 综合测试            ├─ 统一启动入口                        │
│  ├─ 功能验证            ├─ 预检查                              │
│  └─ 性能测试            └─ 模式选择                            │
└─────────────────────────────────────────────────────────────────┘
```

## 核心组件说明

### 1. 数据层 (Data Layer)
- **PDF处理器**: 提取PDF内容，生成结构化数据
- **向量化引擎**: 将文本转换为向量表示
- **向量数据库**: 存储和检索向量数据

### 2. AI服务层 (AI Service Layer)
- **多模型支持**: 集成多种AI模型API
- **配置管理**: 灵活的模型配置和切换
- **统一接口**: 标准化的AI服务接口

### 3. RAG管道层 (RAG Pipeline Layer)
- **检索增强生成**: 结合向量搜索和AI生成
- **上下文构建**: 智能构建相关上下文
- **提示词工程**: 优化AI输入提示

### 4. 接口层 (Interface Layer)
- **聊天界面**: 交互式命令行界面
- **Web API**: RESTful API服务
- **多端支持**: 支持多种客户端

### 5. 工具层 (Utility Layer)
- **测试工具**: 全面的功能测试
- **启动脚本**: 便捷的启动入口
- **监控工具**: 系统状态监控

## 数据流图

```
用户输入
    │
    ▼
┌─────────────┐
│ 查询处理    │
└─────────────┘
    │
    ▼
┌─────────────┐    ┌─────────────┐
│ 向量检索    │───▶│ 相关文档    │
└─────────────┘    └─────────────┘
    │                      │
    ▼                      ▼
┌─────────────┐    ┌─────────────┐
│ 上下文构建  │◀───│ 文档内容    │
└─────────────┘    └─────────────┘
    │
    ▼
┌─────────────┐
│ 提示词生成  │
└─────────────┘
    │
    ▼
┌─────────────┐
│ AI模型生成  │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 结果返回    │
└─────────────┘
```

## 技术栈

### 后端技术
- **Python 3.8+**: 主要编程语言
- **ChromaDB**: 向量数据库
- **Sentence Transformers**: 文本向量化
- **Flask**: Web框架
- **OpenAI API**: AI模型接口

### AI模型支持
- **OpenAI**: GPT-3.5, GPT-4
- **Anthropic**: Claude-3
- **Ollama**: 本地模型
- **通义千问**: 阿里云AI
- **DeepSeek**: DeepSeek Chat

### 数据处理
- **PyMuPDF**: PDF解析
- **pandas**: 数据处理
- **numpy**: 数值计算
- **Pillow**: 图像处理

## 部署架构

### 开发环境
```
本地开发机
├─ Python环境
├─ 向量数据库 (ChromaDB)
├─ AI模型API
└─ 本地文件存储
```

### 生产环境
```
Web服务器
├─ Flask应用
├─ 向量数据库
├─ AI模型API
├─ 负载均衡
└─ 监控系统
```

## 扩展性设计

### 水平扩展
- 支持多实例部署
- 数据库集群
- 负载均衡

### 垂直扩展
- 支持更多AI模型
- 自定义向量化模型
- 插件化架构

### 功能扩展
- 多语言支持
- 实时协作
- 版本控制
- 权限管理

## 安全考虑

### 数据安全
- API密钥加密存储
- 数据传输加密
- 访问控制

### 隐私保护
- 本地模型支持
- 数据脱敏
- 审计日志

## 性能优化

### 缓存策略
- 向量缓存
- 结果缓存
- 模型缓存

### 并发处理
- 异步处理
- 队列管理
- 资源池

### 监控告警
- 性能监控
- 错误告警
- 资源使用
